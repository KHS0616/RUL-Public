# Chain
체인은 스텝 체인과 구동 체인으로 분류가 가능하다.  
각각의 특성을 이용하여 링크 간격을 구하고 최종적으로 신율을 계산한다.  
측정된 신율을 HI 그래프의 입력 데이터로 활용하고 RUL을 예측한다.

## Bandpass Filter
잡음을 없애고 신호를 강조하기 위해 특정 대역폭을 지정하여 필터링을 한다.  
대역통과필터는 Matlab과 비교하여 가장 부합한 라이브러리를 사용한다.  
아래는 왼쪽부터 스텝 체인, 구동 체인의 필터링 결과다.  
![Gear RUL Graph](../img/Step_Bandpass.PNG)![Gear RUL Graph](../img/RS_Bandpass.PNG)  

## Min Variance
구동 체인의 경우에는 범용적으로 신호가 출력되는 대역폭만으로 필터링하기에는 현장의 환경 변수를 무시할 가능성이 있다.  
이를 방지하기 위해 체인의 링크간 길이는 거의 일정하다는 원리를 이용한다.  
특정 방식을 이용하여 대역폭을 세밀하게 분석하여 최적의 대역폭을 찾는다.  
최적의 대역폭의 기준은 피크 값을 구하고 해당 피크간 간격의 최소 분산 값을 이용한다.

## Bandstop Filter
대역통과필터를 이용하여 데이터를 필터링한 후에도 현장에서의 데이터에서 잡음으로 추정되는 주파수 대역 STFT 를 통해 확인할 수 있다.  
![Gear RUL Graph](../img/RS_SFTP_Before.PNG)![Gear RUL Graph](../img/RS_SFTP_Lab.PNG)     
(좌 현장, 우 실험실)  
해당 주파수 대역을 제거하기 위해 대역차단필터를 이용한다.   
![Gear RUL Graph](../img/RS_Spectrum_Before.png)![Gear RUL Graph](../img/RS_Spectrum_After.png)   
주파수의 첨도 그래프를 이용하여 첨도가 높은 주파수 대역을 대상으로 다른 대상보다 비 정상적으로 첨도가 높은 주파수 대역을 선택하여 제거한다. (좌 제거 전, 우 제거 후)

## AutoCorrelation
스텝 체인은 구동 체인과 다르게 신호를 추출하는데 많은 어려움이 있다.  
스텝 체인의 신호를 추출하기 위해 자기상관함수를 이용한다.  

![Gear RUL Graph](../img/ACF.png)  
자기상관함수는 임의의 어떤 신호와 그 신호를 임의의 시간만큼 지연시킨 신호 사이의 상관관계를 파악할 수 있는 함수이다.  
상관관계는 유사성을 의미하는데, 지연 시간에 대해 초기 신호의 성분이 계속해서 지속되고 있다면 ACF는 높은 상관관계를 나타낼 것이다.  
반대로 초기 신호의 성분이 사라지고 거의 존재하지 않는다면 그 지연 시간에 대한 ACF는 낮은 상관관계를 나타낼 것이다.  
즉, 스텝의 소리가 주기적으로 발생하는데, ACF를 사용하면 초기 신호의 성분이 주기적으로 지속이 된다면 값이 높게 찍힐 것이고 여기에 피크 값을 찍으면, 스텝의 소리라고 할 수 있다.
  
자기상관함수를 사용하기에 앞서 파이썬에는 여러 라이브러리가 존재한다.  
각각의 라이브러리와 Matlab에서 제공하는 함수를 비교하여 라이브러리를 선택한다.  

![Gear RUL Graph](../img/librosa_ACF.PNG)![Gear RUL Graph](../img/Numpy_ACF.PNG)  
위 그림과 같이 librosa, numpy에서 제공하는 자기상관함수의 결과는 동일하게 나오지만, numpy를 이용한 방식은 많은 시간을 필요하므로 librosa 방식을 사용한다.  

## Find Peak
체인의 링크 간격은 모든 구간에서 일정하므로 피크의 간격의 분산 또한 0에 가까운 값으로 측정될 것이다.  
이를 이용하여 스텝, 구동 각각의 특징을 이용하여 전처리를 한 후, 최종적으로 피크 값을 찍고 그 간격의 분산이 가장 작은 구간을 실제 신호가 측정되는 구간으로 가정한다.  

![Gear RUL Graph](../img/Step_Peak.PNG)![Gear RUL Graph](../img/Step_Peak_Lab.PNG)  
스텝 체인 같은 경우는 자기상관함수를 사용한 후에 피크 값을 찍는데, 시각적으로는 판별하기가 힘들지만 해당 결과를 통해 체인의 길이를 계산하면 실제 길이와 유사한 결과를 얻는다.  
(좌 현장, 우 실험실)  
![Gear RUL Graph](../img/RS_Peak.PNG)![Gear RUL Graph](../img/RS_Peak_Lab.PNG)   
구동 체인의 특징을 이용하여 전처리 과정을 진행 후, 피크 값을 찍은 그림이다.  
(좌 현장, 우 실험실)


# Gear and Bearing
회전 기계에서 기어는 톱니라고도 불린다.  
기어는 기어와 피니언간 맞물릴때 특정한 소음이 발생한다.  
해당 소음을 기어 맞물림 주파수라고 하고 GMF라고 불린다.  
GMF는 기어의 수명과 직접적인 연관이 있는 요소중 하나이며, 본 연구에서는 GMF를 통해 기어의 잔존수명을 예측하려고 한다.  

베어링 또한 회전 기계에서 중요한 요소이다.  
외륜, 내륜, 볼 베어링 결함이 있으며 베어링 결함시 발생되는 고유한 주파수가 있다.  
해당 대역폭을 포락선 분석을 이용하여 수치화하고 잔존수명을 예측하려고 한다.  

## GAN
![GAN](../img/GAN.png)  

잔존수명을 예측하기 위해서는 정상 상태부터 완전히 고장 상태가 될 때까지의 방대한 데이터가 필요하다.  
하지만, 현실적인 문제로 데이터 수집이 어려운점이 있다.  
이를 보완하기위해 적대적 생성 신경망인 GAN을 이용하려고 한다.  
GAN의 생성모델을 이용하여 실제데이터와 유사한 더미데이터를 만들어 학습에 활용하려고 한다.  

## 특징 추출
HI 그래프를 그리기 위해서는 수명과 연관된 특징을 추출해야한다.  
![GMF](../img/GMF.PNG)  
위 그림과 같이 기어의 내부구조상 기어가 맞물리는 주파수가 발생한다.  
기어의 수명과 관련된 특징은 이 GMF와 조화주파수가 있는데, 본 연구에서는 GMF의 진폭 값을 이용해서 HI 그래프를 그리려고 한다.  

![RMS](../img/RMS.PNG)  
베어링의 특징을 추출하기 위해서는 RMS수식을 이용한다.  
베어링의 주파수는 매우 미세하게 발견되기 때문에, 해당 수식을 이용하여 특징을 추출하는 과정을 거친다.    

## CNN
각각의 특징을 이용하여 HI 그래프를 예측하기 위한 입력데이터는 수집했지만, 방대한 빅데이터에서 해당 과정을 반복하기에는 많은 시간이 필요하게 된다.  
![Spectrogram](../img/Spectrogram.PNG)![Kurtogram](../img/Kurtogram.PNG)  
이를 해결하기 위하여 합성곱신경망인 CNN을 이용하여 정상, 결함 상태에서의 스펙트럼을 입력데이터로 새로운 입력데이터를 분석하는 과정을 거친다.  
(좌 주파수 스펙트럼, 우 첨도 스펙트럼)  

## HI Graph
아래는 위 과정을 통해 출력된 HI 그래프다.  
![Spectrogram](../img/GearBearingResult.PNG)